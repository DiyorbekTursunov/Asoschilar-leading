<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asoschilar - Video</title>

  <!-- Critical resource hints -->
  <link rel="preload" href="img/img.webp" as="image">
  <link rel="preload" href="img/Line.svg" as="image">
  <link rel="preconnect" href="https://www.youtube.com">
  <link rel="preconnect" href="https://script.google.com">

  <!-- Inline critical CSS -->
  <style>
    /* Critical CSS - Inlined for 0 render blocking time */
    *,*::before,*::after{box-sizing:border-box;border:0 solid #e5e7eb}
    html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,sans-serif}
    body{margin:0;line-height:inherit}
    button,input{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}
    button{cursor:pointer}
    img{vertical-align:middle;max-width:100%;height:auto}
    [hidden]{display:none}

    /* Video Page Layout */
    .video-page{background:url("img/img.webp") center/cover,#000;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .video-section{max-width:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;margin-bottom:2.5rem}
    .video-section__title{font-weight:700;color:#fff;text-align:center;font-size:25px;line-height:1.25;text-transform:uppercase;margin-bottom:2.5rem;padding:0 1.25rem}
    .video-section__highlight{color:#ff9900}
    .video-section__highlight--danger{color:#ff0000}
    .video-section__divider{margin-bottom:2.5rem;height:2.5rem}
    .video-section__player-container{display:flex;justify-content:center;width:100%;margin-bottom:1rem}
    .video-section__player{max-width:749px;width:100%;height:250px;object-fit:contain;border:none;border-radius:.5rem}
    .video-section__cta{margin-top:-1rem}

    /* Button Component */
    .button{display:inline-block;font-weight:600;text-align:center;border-radius:.75rem;transition:transform .2s;border:none;cursor:pointer}
    .button:hover{transform:scale(1.05)}
    .button--primary{background:#ff9900;color:#000;font-size:1.5rem;line-height:1.5rem;padding:1.25rem 2.25rem;padding-top:18px;text-transform:capitalize}
    .button--secondary{background:#1a56db;color:#fff;font-size:.875rem;padding:.625rem 1.25rem;font-weight:500;border-radius:.5rem}
    .button--secondary:hover{background:#1e42a0}
    .button--full-width{width:100%}

    /* Modal and Form Components */
    .modal{position:fixed;top:0;left:0;width:100%;height:100vh;z-index:40}
    .modal--hidden{display:none}
    .modal--visible{display:flex}
    .modal__backdrop{display:flex;align-items:center;justify-content:center;width:100%;height:100vh;position:relative;padding:0 1.25rem}
    .modal__overlay{position:absolute;top:0;left:0;width:100%;height:100vh;background:rgba(0,0,0,.8)}
    .modal__form{position:relative;z-index:20;background:#fff;max-width:450px;width:100%;margin:auto;display:flex;flex-direction:column;padding:2.5rem;border-radius:.5rem}
    .modal__close{display:flex;position:absolute;top:.5rem;right:.5rem;background:none;border:none;cursor:pointer;padding:.25rem}
    .form-field{margin-bottom:1.25rem;width:100%;display:grid}
    .form-field__label{display:block;margin-bottom:.5rem;font-size:.875rem;font-weight:500;color:#111827}
    .form-field__input{background:#f9fafb;border:1px solid #d1d5db;color:#111827;font-size:.875rem;border-radius:.5rem;padding:.625rem;width:100%}
    .form-field__input:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}
    .form-field__error{color:#f05252;font-size:.875rem;margin-top:.25rem}
    .form-field--radio{margin-bottom:1.25rem;width:100%;display:grid;align-items:start}
    .form-field__radio-group{display:flex;gap:1.25rem;margin-top:.5rem}
    .form-field__radio-option{display:flex;align-items:center;gap:.5rem}
    .form-field__radio-input{appearance:none;height:1rem;width:1rem;background:#fff;border:1px solid #6b7280;border-radius:100%;cursor:pointer}
    .form-field__radio-input:checked{border-color:#1c64f2;background:#1c64f2;background-image:url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e")}
    .form-field__radio-label{font-size:.875rem;color:#111827;cursor:pointer}

    /* Loader */
    .loader{width:100%;height:100vh;background:rgba(0,0,0,.5);position:fixed;top:0;left:0;z-index:40;align-items:center;justify-content:center}
    .loader--hidden{display:none}
    .loader--visible{display:flex}
    .loader__spinner{position:relative;width:54px;height:54px}
    .loader__bar{width:8%;height:24%;background:#fff;position:absolute;left:50%;top:30%;opacity:0;border-radius:50px;animation:spin 1s linear infinite}
    @keyframes spin{0%{opacity:1}100%{opacity:.25}}
    .loader__bar--1{transform:rotate(0deg) translate(0,-130%);animation-delay:0s}
    .loader__bar--2{transform:rotate(30deg) translate(0,-130%);animation-delay:-.1s}
    .loader__bar--3{transform:rotate(60deg) translate(0,-130%);animation-delay:-.2s}
    .loader__bar--4{transform:rotate(90deg) translate(0,-130%);animation-delay:-.3s}
    .loader__bar--5{transform:rotate(120deg) translate(0,-130%);animation-delay:-.4s}
    .loader__bar--6{transform:rotate(150deg) translate(0,-130%);animation-delay:-.5s}
    .loader__bar--7{transform:rotate(180deg) translate(0,-130%);animation-delay:-.6s}
    .loader__bar--8{transform:rotate(210deg) translate(0,-130%);animation-delay:-.7s}
    .loader__bar--9{transform:rotate(240deg) translate(0,-130%);animation-delay:-.8s}
    .loader__bar--10{transform:rotate(270deg) translate(0,-130%);animation-delay:-.9s}
    .loader__bar--11{transform:rotate(300deg) translate(0,-130%);animation-delay:-1s}
    .loader__bar--12{transform:rotate(330deg) translate(0,-130%);animation-delay:-1.1s}

    /* Responsive */
    @media (min-width:768px){
      .video-section{max-width:980px;margin:0 auto 2.5rem auto}
      .video-section__title{margin-bottom:25px}
      .video-section__player{height:388px}
      .video-section__cta{margin-top:0}
      .modal__form{width:100%}
    }
    @media (min-width:1024px){
      .video-section__title{font-size:40px}
    }
  </style>
</head>
<body class="video-page">
  <div class="video-section">
    <h2 class="video-section__title">
      Bu sahifani <span class="video-section__highlight">yopmang</span>, bo'lmasa bu videoni butun umrga <span class="video-section__highlight--danger">yo'qotasiz.</span>
    </h2>

    <img src="img/Line.svg" class="video-section__divider" alt="Divider line" loading="lazy">

    <div class="video-section__player-container">
      <iframe
        id="youtube-video"
        class="video-section__player"
        src="https://www.youtube.com/embed/KOSRcXDqUlI?si=NEDO47j0gLHbDLZE"
        title="YouTube video player"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen
        loading="lazy">
      </iframe>
    </div>

    <button id="btn" class="button button--primary video-section__cta">
      Konsultatsiya Olish
    </button>
  </div>

  <!-- Modal with extended form -->
  <div class="modal modal--hidden">
    <div class="modal__backdrop">
      <div class="modal__overlay"></div>
      <form id="form" class="modal__form">
        <button type="button" id="close" class="modal__close">
          <svg width="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
            <path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"></path>
          </svg>
        </button>

        <div class="form-field">
          <label for="name" class="form-field__label">Ismingiz:</label>
          <input type="text" id="name" name="Ismingiz" class="form-field__input" placeholder="Ismingiz..." required>
          <span class="form-field__error error-message"></span>
        </div>

        <div class="form-field">
          <label for="phone" class="form-field__label">Telefon raqamingiz:</label>
          <input type="tel" id="phone" name="Telefon" class="form-field__input" placeholder="Telefon raqamingiz..." maxlength="15" required>
          <span class="form-field__error error-message"></span>
        </div>

        <div class="form-field">
          <label for="jop" class="form-field__label">Biznesingiz nomi va faoliyat sohangiz:</label>
          <input type="text" id="jop" name="Biznesingiz nomi" class="form-field__input" placeholder="Biznesingiz nomi va faoliyat sohangiz..." required>
          <span class="form-field__error error-message"></span>
        </div>

        <div class="form-field">
          <label for="jopIsue" class="form-field__label">Marketingdagi sizni qiynayotgan muammo:</label>
          <input type="text" id="jopIsue" name="Marketingdagi sizni qiynayotgan muammo:" class="form-field__input" placeholder="Marketingdagi sizni qiynayotgan muammo..." required>
          <span class="form-field__error error-message"></span>
        </div>

        <div class="form-field--radio">
          <label class="form-field__label">Oldin marketing agentliklari bilan ishlaganmisiz:</label>
          <div class="form-field__radio-group">
            <div class="form-field__radio-option">
              <input name="ishlaganmisiz" type="radio" id="yes" class="form-field__radio-input" value="Ha">
              <label for="yes" class="form-field__radio-label">Ha</label>
            </div>
            <div class="form-field__radio-option">
              <input name="ishlaganmisiz" type="radio" id="no" class="form-field__radio-input" value="Yo'q">
              <label for="no" class="form-field__radio-label">Yo'q</label>
            </div>
          </div>
          <span class="form-field__error error-message-checkbox"></span>
        </div>

        <button type="submit" class="button button--secondary button--full-width">
          Yuborish
        </button>
      </form>
    </div>
  </div>

  <!-- Loader -->
  <div id="loader" class="loader loader--hidden">
    <div class="loader__spinner">
      <div class="loader__bar loader__bar--1"></div>
      <div class="loader__bar loader__bar--2"></div>
      <div class="loader__bar loader__bar--3"></div>
      <div class="loader__bar loader__bar--4"></div>
      <div class="loader__bar loader__bar--5"></div>
      <div class="loader__bar loader__bar--6"></div>
      <div class="loader__bar loader__bar--7"></div>
      <div class="loader__bar loader__bar--8"></div>
      <div class="loader__bar loader__bar--9"></div>
      <div class="loader__bar loader__bar--10"></div>
      <div class="loader__bar loader__bar--11"></div>
      <div class="loader__bar loader__bar--12"></div>
    </div>
  </div>

  <!-- Ultra-optimized JavaScript with Google Sheets integration -->
  <script>
    // Google Sheets configuration for video page
    const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbxcG93ncf2IKPKaC36qRNkaR88pXqDTQwnhypMKqvoYagZu3LDJUjYDX7TFJIkhdyEIYA/exec';

    // Cache DOM elements
    const modal = document.querySelector(".modal");
    const btn = document.querySelector("#btn");
    const close = document.querySelector("#close");
    const overlay = document.querySelector(".modal__overlay");
    const form = document.getElementById("form");
    const loader = document.getElementById("loader");

    // Modal functions
    const showModal = () => {
      modal.classList.remove("modal--hidden");
      modal.classList.add("modal--visible");
    };

    const hideModal = () => {
      modal.classList.add("modal--hidden");
      modal.classList.remove("modal--visible");
    };

    // Event listeners
    btn?.addEventListener("click", showModal);
    close?.addEventListener("click", hideModal);
    overlay?.addEventListener("click", hideModal);

    // Phone number formatting
    document.getElementById("phone")?.addEventListener("input", function (event) {
      let value = event.target.value.replace(/\D/g, "");
      let formatted = "";

      if (value.length > 0) formatted += "(" + value.substring(0, 2);
      if (value.length >= 3) formatted += ") " + value.substring(2, 5);
      if (value.length >= 6) formatted += "-" + value.substring(5, 7);
      if (value.length >= 8) formatted += "-" + value.substring(7, 9);

      event.target.value = formatted;
    });

    // Form validation and submission
    form?.addEventListener("submit", async function (event) {
      event.preventDefault();

      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const business = document.getElementById("jop").value.trim();
      const jopIsue = document.getElementById("jopIsue").value.trim();

      // Get radio button value
      const radioInputs = document.querySelectorAll('input[name="ishlaganmisiz"]');
      let radioValue = "";
      radioInputs.forEach(input => {
        if (input.checked) radioValue = input.value;
      });

      let isValid = true;

      // Clear previous errors
      document.querySelectorAll(".error-message").forEach(el => el.textContent = "");
      document.querySelector(".error-message-checkbox").textContent = "";

      // Validation
      if (!name) {
        document.querySelector("#name + .error-message").textContent = "Iltimos, ismingizni kiriting.";
        isValid = false;
      }

      const phonePattern = /^$$\d{2}$$ \d{3}-\d{2}-\d{2}$/;
      if (!phone || !phonePattern.test(phone)) {
        document.querySelector("#phone + .error-message").textContent = "Telefon raqamingizni (88) 000-00-00 formatida kiriting.";
        isValid = false;
      }

      if (!business) {
        document.querySelector("#jop + .error-message").textContent = "Iltimos, biznesingiz nomi va faoliyat sohasini kiriting.";
        isValid = false;
      }

      if (!jopIsue) {
        document.querySelector("#jopIsue + .error-message").textContent = "Iltimos, marketingdagi muammoingizni kiriting.";
        isValid = false;
      }

      if (!radioValue) {
        document.querySelector(".error-message-checkbox").textContent = "Iltimos, variantlardan birini tanlang.";
        isValid = false;
      }

      if (isValid) {
        loader.classList.remove("loader--hidden");
        loader.classList.add("loader--visible");

        try {
          const formData = new FormData();
          formData.append("Ismingiz", name);
          formData.append("Telefon", phone);
          formData.append("Biznesingiz nomi", business);
          formData.append("Marketingdagi sizni qiynayotgan muammo:", jopIsue);
          formData.append("Marketing agentligi bilan ishlaganmi", radioValue);
          formData.append("Sana", new Date().toLocaleString('uz-UZ'));
          formData.append("Sahifa", "Video Page");

          const response = await fetch(GOOGLE_SHEETS_URL, {
            method: "POST",
            body: formData,
            mode: 'no-cors'
          });

          // Success feedback
          hideModal();
          form.reset();

          // Show success message
          const successMsg = document.createElement('div');
          successMsg.innerHTML = `
            <div style="position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:1rem 2rem;border-radius:0.5rem;z-index:9999;box-shadow:0 10px 25px rgba(0,0,0,0.1);">
              ✅ Ma'lumot muvaffaqiyatli yuborildi!
            </div>
          `;
          document.body.appendChild(successMsg);

          setTimeout(() => successMsg.remove(), 3000);

        } catch (error) {
          console.error("Error:", error);

          // Show error message
          const errorMsg = document.createElement('div');
          errorMsg.innerHTML = `
            <div style="position:fixed;top:20px;right:20px;background:#ef4444;color:white;padding:1rem 2rem;border-radius:0.5rem;z-index:9999;box-shadow:0 10px 25px rgba(0,0,0,0.1);">
              ❌ Xatolik yuz berdi. Qayta urinib ko'ring.
            </div>
          `;
          document.body.appendChild(errorMsg);

          setTimeout(() => errorMsg.remove(), 3000);

        } finally {
          loader.classList.add("loader--hidden");
          loader.classList.remove("loader--visible");
        }
      }
    });
  </script>
</body>
</html>
